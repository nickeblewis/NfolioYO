"use strict";angular.module("farnboroughyoApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","firebase"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/show/:placeId",{templateUrl:"views/show.html",controller:"ShowCtrl"}).when("/edit/:placeId",{templateUrl:"views/edit.html",controller:"EditCtrl"}).when("/test",{templateUrl:"views/test.html",controller:"TestCtrl"}).when("/create",{templateUrl:"views/edit.html",controller:"CreateCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("farnboroughyoApp").controller("MainCtrl",["$scope","$timeout","fbRequestUrl","fbEvents","fbAUTH","fbURL","Auth",function(a,b,c,d,e,f){var g=!1;a.canbetested=!0;var h=new Firebase(e);new FirebaseSimpleLogin(h,function(a,b){a?console.log(a):b?(console.log("User ID: "+b.id+", Provider: "+b.provider),g=!0):console.log("User has logged out")}),a.isAuthorised=!1,a.authmessage="",a.status="Loading...",a.places=c,a.$watch("places",function(){console.log("Places has updated ")}),a.places.$on("loaded",function(){a.status="Watch this spot for live updates across the site!",a.loaded=!0}),d.on("child_changed",function(b){var c=b.val().name;a.status=c+" has been updated",console.log("child_changed")}),d.on("child_added",function(b){var c=b.val().name;a.status=c+" has been added"}),d.on("child_removed",function(b){var c=b.val().name;a.status=c+" has been removed"}),a.modalShown=!1,a.toggleModal=function(){a.modalShown=!a.modalShown},a.save=function(){a.places.$save()},a.timeAgo=function(a){return moment(a).fromNow()},a.postStatus=function(b){var c=new Firebase(f+b+"/feed"),d=c.push();d.set({message:a.post,updated:(new Date).getTime()})}}]),angular.module("farnboroughyoApp").directive("jumbotron",function(){return{template:'<div class="jumbotron"><h1>{{jtHeading}}</h1><p class="lead">{{jtIntro}}</p><p><a class="btn btn-lg btn-success" ng-href="#">{{jtButton}}</a></p></div>',restrict:"EA",replace:!0,scope:{jtHeading:"@",jtIntro:"@",jtButton:"@"}}}),angular.module("farnboroughyoApp").factory("fbRequestUrl",["$firebase","fbURL",function(a,b){var c=new Firebase(b);return new FirebaseSimpleLogin(c,function(a,b){console.log(a?a:b?"factory User ID: "+b.id+", Provider: "+b.provider:"factory User has logged out")}),a(c)}]).factory("Auth",["$firebase","$rootScope","fbAUTH",function(a,b,c){var d=new Firebase(c),e=FirebaseSimpleLogin(d,function(a,c){a?console.log(a):c?(console.log("factory User ID: "+c.id+", Provider: "+c.provider),b.signedIn=!0,b.signedInAs=c):(console.log("factory User has logged out"),b.signedIn=!1)}),f={register:function(a){e.createUser(a.email,a.password,function(a,b){console.log("New user "+b.id+" was created")})},signedIn:function(){return b.signedIn},signedInAs:function(){return b.signedInAs},login:function(a){return b.signedIn=!0,e.login("password",a)},logout:function(){return e.logout(),b.signedIn=!1,b.signedIn}};return f}]),angular.module("farnboroughyoApp").factory("fbEvents",["$firebase","fbURL","fbAuthToken",function(a,b,c){var d=new Firebase(b);return d.auth(c),d}]),angular.module("farnboroughyoApp").value("fbAuthToken","b9b3dbbcf69fdad7365f3fb61ad21927"),angular.module("farnboroughyoApp").value("fbURL","https://farnborough.firebaseio.com/places/"),angular.module("farnboroughyoApp").value("fbAUTH","https://farnborough.firebaseio.com"),angular.module("farnboroughyoApp").controller("ShowCtrl",["$scope","$location","$routeParams","$firebase","fbURL","Auth",function(a,b,c,d,e){var f=e+c.placeId;a.place=d(new Firebase(f)),a.placeId=c.placeId,a.postsuccess=!1,a.postStatus=function(){a.place.updated=(new Date).getTime(),a.place.$save();var b=new Firebase(e+a.placeId+"/feed"),c=b.push();c.set({message:a.status,updated:(new Date).getTime()}),a.postsuccess=!0}}]),angular.module("farnboroughyoApp").controller("EditCtrl",["$scope","$location","$routeParams","$firebase","fbURL","Auth",function(a,b,c,d,e,f){var g=e+c.placeId;a.place=d(new Firebase(g)),a.place.userid=f.signedInAs().id,a.destroy=function(){a.place.$remove(),b.path("/")},a.save=function(){a.place.updated=(new Date).getTime(),a.place.$save(),b.path("/")}}]),angular.module("farnboroughyoApp").directive("searchbar",function(){return{template:'<div class="col-md-12 card search"><div class="status-bar"><input type="text" ng-model="search" class="form-control" placeholder="Search"></div></div>',restrict:"EA",replace:!0}}),angular.module("farnboroughyoApp").directive("statusbar",function(){return{template:'<div class="col-md-12 card"><div class="status-bar"><strong>{{status}}</strong></div></div>',restrict:"EA",replace:!0}}),angular.module("farnboroughyoApp").directive("grid",function(){return{template:'<div class="col-md-12 place-card element general"><div class="isotope" isotope-container  iso-use-init-event="true" iso-method-subscribe="my-iso-method" ng-cloak><div class="repeat-item col-md-3 col-sm-6 element place-card general" ng-repeat="place in places | orderByPriority | filter:search | orderBy:updated:reverse=true" isotope-item><div class="hover_img {{place.class}}"><h2><a data-ng-href="#/show/{{place.$id}}">{{place.name}}</a></h2></div><div class="item_description"><img src="http://placehold.it/150x150" ng-if="place.pic != null" /><p class="content" ng-show="isAuthorised" editable-textarea="place.description" e-cols="17" e-rows="6" e-style="width: 100%; font-size: 14px;" onaftersave="save()">{{place.description || "empty"}}         </p><p class="content" ng-show="!isAuthorised">{{place.description || "empty"}}         </p><p class="meta">Updated {{timeAgo(place.updated)}}</p></div></div></div></div>',restrict:"E",replace:!0}}),angular.module("farnboroughyoApp").directive("filelistBind",function(){return function(a,b,c){b.bind("change",function(b){a.$apply(function(){a[c.name]=b.target.files,console.log(a[c.name])})})}}),angular.module("farnboroughyoApp").controller("TestCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("farnboroughyoApp").controller("CreateCtrl",["$scope","$location","$timeout","fbRequestUrl","fbURL","$anchorScroll","Auth",function(a,b,c,d,e,f,g){a.place={},navigator.geolocation.getCurrentPosition(function(b){a.place.lat=b.coords.latitude,a.place.lng=b.coords.longitude}),a.save=function(){if(a.myForm.$valid){var c=new Firebase(e),d=c.push();if(a.place.updated=(new Date).getTime(),d.set({name:a.place.name,description:a.place.description,lat:a.place.lat,lng:a.place.lng,updated:a.place.updated,userid:g.signedInAs().id}),a.files){var h=a.files[0],i=new FileReader;i.onload=function(){return function(a){var b=a.target.result;d.update({file:b})}}(h),i.readAsDataURL(h)}b.path("/")}else b.hash("name"),f()}}]),angular.module("farnboroughyoApp").controller("LoginCtrl",["$scope","$firebase","Auth","$location",function(a,b,c){a.user={},a.login=function(){c.login(a.user)},a.logout=function(){c.logout()},a.signedIn=function(){return c.signedIn()},a.signedInAs=function(){return c.signedInAs().email},a.register=function(){c.register(a.user)}}]),angular.module("farnboroughyoApp").run(["$templateCache",function(a){a.put("headernav.html",'<div class="header"><ul class="nav nav-pills pull-right"><li><a ng-href="#/create" ng-show="signedIn()">Create</a></li><li><a ng-href="#/login" ng-show="!signedIn()">Login</a></li><li><a ng-click="logOut()" ng-show="signedIn()">Logout</a></li></ul><h3 class="text-muted"><a ng-href="/">FG</a></h3></div>')}]).controller("HeaderNavCtrl",function(a,b,c,d,e,f){a.logIn=function(){a.isAuthorised=!0,a.authmessage="You have successfully logged in"},a.signedIn=function(){return f.signedIn()},a.logOut=function(){return f.logout()}}).directive("headernav",function(){return{templateUrl:"headernav.html",restrict:"EA",replace:!0,controller:"HeaderNavCtrl"}}),angular.module("farnboroughyoApp").run(["$templateCache",function(a){a.put("footernav.html",'<div class="footer"><p>â™¥ from the FG team</p></div>')}]).directive("footernav",function(){return{templateUrl:"footernav.html",restrict:"EA",replace:!0}}),angular.module("farnboroughyoApp").run(["$templateCache",function(a){a.put("statuspost.html",'<li class="feed-item-add"><form class="form-inline" role="form" name="myForm"><div class="form-group"><input type="text" class="form-control" id="inputStatus" placeholder="add a status post" ng-model="post"></div><div class="form-group"><button ng-click="postStatus(place.$id)"class="btn btn-primary">Post</button></div></form></li>')}]).controller("StatuspostCtrl",function(a,b,c,d,e,f){a.postStatus=function(b){var c=new Firebase(f+b+"/feed"),d=c.push();d.set({message:a.post,updated:(new Date).getTime()})}}).directive("statuspost",function(){return{templateUrl:"statuspost.html",restrict:"EA",replace:!0,scope:{place:"="},controller:"StatuspostCtrl"}}),angular.module("farnboroughyoApp").run(["$templateCache",function(a){a.put("feedlist.html",'<ul class="feed-list list-group" ng-show="place.feed">	<li class="feed-item-post list-group-item" class="animate" ng-repeat="item in place.feed | orderByPriority | orderBy:\'updated\':reverse=true | limitTo: 3"><span class="badge">{{timeAgo(item.updated)}}</span><i class="glyphicon glyphicon-user"></i> {{item.message}}</li><div ng-transclude></div></ul>')}]).directive("feedlist",function(){return{templateUrl:"feedlist.html",restrict:"EA",replace:!0,transclude:!0}}),angular.module("farnboroughyoApp").run(["$templateCache",function(a){a.put("placelist.html",'<div class="row main"><div ng-show="loaded" class="animate-repeat col-md-12 card" ng-repeat="place in places | orderByPriority | filter:search | orderBy:\'updated\':reverse=true"><strong><a data-ng-href="#/show/{{place.$id}}">{{place.name}}</a></strong> <i>Updated {{timeAgo(place.updated)}}</i><p class="card-content" ng-show="isAuthorised" editable-textarea="place.description" e-cols="17" e-rows="6" e-style="width: 100%; font-size: 14px;" onaftersave="save()">{{place.description || "empty"}}</p><p class="card-content" ng-show="!isAuthorised">{{place.description || "empty"}}<div ng-transclude></div></p></div></div>')}]).directive("placelist",function(){return{templateUrl:"placelist.html",restrict:"EA",replace:!0,transclude:!0}}),angular.module("farnboroughyoApp").run(["$templateCache",function(a){a.put("createplace.html",'<div class="animate-repeat col-md-12 card"><div class="panel panel-default" ng-show="!createMode"><div class="panel-heading">Create/Edit</div><div class="panel-body"><br/><p><form class="form-horizontal" role="form" name="myForm"><div class="form-group" ng-class="{error: myForm.name.$invalid && !myForm.name.$pristine}"><label for="inputEmail3" class="col-sm-2 control-label">Name</label><div class="col-sm-10"><input type="text" class="form-control" id="inputEmail3" placeholder="Name" name="name" ng-model="place.name" required><span ng-show="myForm.name.$error.required && !myForm.name.$pristine" class="help-inline">Required {{myForm.name.$pristine}}</span></div></div><div class="form-group"><label for="inputPassword3" class="col-sm-2 control-label">Description</label><div class="col-sm-10"><textarea class="form-control" rows="5" name="description" ng-model="place.description"></textarea></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="#/" class="btn">Cancel</a><button ng-click="save()" ng-disabled="myForm.$invalid"class="btn btn-primary" class="btn btn-default">Save</button><button ng-click="destroy()"ng-show="place.$remove" class="btn btn-danger">Delete</button></div></div></form></p></div></div>')}]).controller("CreatePlaceCtrl",function(a,b,c,d,e,f,g){a.place={},navigator.geolocation.getCurrentPosition(function(b){a.place.lat=b.coords.latitude,a.place.lng=b.coords.longitude}),a.save=function(){if(a.myForm.$valid){var c=new Firebase(e),d=c.push();if(a.place.updated=(new Date).getTime(),d.set({name:a.place.name,description:a.place.description,lat:a.place.lat,lng:a.place.lng,updated:a.place.updated,userid:g.signedInAs().id}),a.files){var h=a.files[0],i=new FileReader;i.onload=function(){return function(a){var b=a.target.result;d.update({file:b})}}(h),i.readAsDataURL(h)}b.path("/")}else b.hash("name"),f()}}).directive("createplace",function(){return{templateUrl:"createplace.html",restrict:"EA",controller:"CreatePlaceCtrl"}});